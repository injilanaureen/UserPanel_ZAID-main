import{r as i,a as Q,j as e,S as Z}from"./app-Dg_mqjos.js";import{A as $,U as ee}from"./AdminLayout-4b2aWxON.js";import{B as se}from"./bus-xnmjalu2.js";import{M as p}from"./map-pin-Cz_G7YVb.js";import{S as E}from"./search-JSqcYkRg.js";import{T as re}from"./ticket-DphGf3-z.js";import{C as L}from"./credit-card-BiKYsvPS.js";import{C as te}from"./circle-alert-rsF7f0yr.js";import{C as ae}from"./circle-check-big-DoeaxPC3.js";import"./x-DY0_j3Km.js";import"./createLucideIcon-CAoF63AR.js";import"./log-out-DnMZeBB4.js";const be=()=>{const[t,l]=i.useState({availableTripId:"",boardingPointId:"",droppingPointId:"",source:"",destination:"",bookingType:"ONLINE",serviceCharge:"",paymentMode:"CASH",inventoryItems:[{seatName:"",fare:"",serviceTax:"",operatorServiceCharge:"",ladiesSeat:"false",passenger:{name:"",mobile:"",title:"Mr",email:"",age:"",gender:"MALE",address:"",idType:"",idNumber:"",primary:"0"}}]}),[N,c]=i.useState({}),[C,x]=i.useState(!1),[m,w]=i.useState(!1),[I,B]=i.useState([]),[S,z]=i.useState([]),[F,q]=i.useState(""),[O,H]=i.useState(""),[T,f]=i.useState(""),[R,U]=i.useState([]),[G,K]=i.useState([]),[k,b]=i.useState(""),[D,y]=i.useState(""),[Y,h]=i.useState(!1),[V,v]=i.useState(!1);i.useEffect(()=>{t.availableTripId&&W()},[t.availableTripId]),i.useEffect(()=>{(async()=>{try{const r=await fetch("/admin/busTicket/fetchSourceCities",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(!r.ok)throw new Error("Network response was not ok");const a=await r.json();if(a.status&&a.data.cities)U(a.data.cities),K(a.data.cities);else throw new Error("Failed to fetch cities data")}catch(r){c({cities:r.message})}})()},[]);const W=async()=>{w(!0);try{const r=(await Q.post("/admin/busTicket/fetchTripDetails",{trip_id:t.availableTripId},{headers:{Accept:"application/json","Content-Type":"application/json"}})).data;r.status&&r.data&&(B(r.data.boardingTimes||[]),z(r.data.droppingTimes||[]))}catch(s){console.error("Error fetching trip details:",s),c({tripDetails:"Failed to load boarding/dropping points"})}finally{w(!1)}},n=(s,r=0)=>{const{name:a,value:o}=s.target;if(c({}),f(""),a.includes("passenger.")){const u=a.split("passenger.")[1];l(g=>({...g,inventoryItems:g.inventoryItems.map((d,j)=>j===r?{...d,passenger:{...d.passenger,[u]:o}}:d)}))}else if(a.includes("inventoryItems.")){const u=a.split(".")[2];l(g=>({...g,inventoryItems:g.inventoryItems.map((d,j)=>j===r?{...d,[u]:o}:d)}))}else l(u=>({...u,[a]:o}))},X=s=>{const r=s.target.value;q(r);const a=I.find(o=>o.address===r);a&&l(o=>({...o,boardingPointId:a.bpId}))},_=s=>{const r=s.target.value;H(r);const a=S.find(o=>o.address===r);a&&l(o=>({...o,droppingPointId:a.bpId}))},A=(s,r)=>{s==="source"?(l(a=>({...a,source:r.id})),b(r.name),h(!1)):(l(a=>({...a,destination:r.id})),y(r.name),v(!1))},J=s=>{s.preventDefault(),x(!0),c({}),f(""),Z.post("/admin/bus-ticket/block/api",t,{onSuccess:()=>{x(!1),f("Ticket blocked successfully!"),l({availableTripId:"",boardingPointId:"",droppingPointId:"",source:"",destination:"",bookingType:"ONLINE",serviceCharge:"",paymentMode:"CASH",inventoryItems:[{seatName:"",fare:"",serviceTax:"",operatorServiceCharge:"",ladiesSeat:"false",passenger:{name:"",mobile:"",title:"Mr",email:"",age:"",gender:"MALE",address:"",idType:"",idNumber:"",primary:"0"}}]}),b(""),y("")},onError:r=>{x(!1),c(r)}})},P=R.filter(s=>s.name.toLowerCase().includes(k.toLowerCase())).slice(0,10),M=G.filter(s=>s.name.toLowerCase().includes(D.toLowerCase())).slice(0,10);return e.jsx($,{children:e.jsx("div",{className:"max-w-full",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Block Bus Ticket"})}),e.jsxs("form",{onSubmit:J,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(se,{size:20,className:"mr-2 text-green-500"}),"Available Trip ID"]}),e.jsx("input",{type:"text",name:"availableTripId",value:t.availableTripId,onChange:n,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(p,{size:20,className:"mr-2 text-yellow-500"}),"Boarding Point"]}),e.jsx("select",{value:F,onChange:X,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",disabled:!t.availableTripId||m,required:!0,children:m?e.jsx("option",{value:"",children:"Loading boarding points..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Select boarding point"}),I.map((s,r)=>e.jsxs("option",{value:s.address,children:[s.address," (ID: ",s.bpId,")"]},r))]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(p,{size:20,className:"mr-2 text-red-500"}),"Dropping Point"]}),e.jsx("select",{value:O,onChange:_,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",disabled:!t.availableTripId||m,required:!0,children:m?e.jsx("option",{value:"",children:"Loading dropping points..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Select dropping point"}),S.map((s,r)=>e.jsxs("option",{value:s.address,children:[s.address," (ID: ",s.bpId,")"]},r))]})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(p,{size:20,className:"mr-2 text-blue-500"}),"Source City"]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:s=>{b(s.target.value),h(!0)},onFocus:()=>h(!0),className:"w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",placeholder:"Search source city...",required:!0}),Y&&P.length>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-lg",children:P.map(s=>e.jsxs("li",{onClick:()=>A("source",s),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[s.name,", ",s.state," (ID: ",s.id,")"]},s.id))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(p,{size:20,className:"mr-2 text-purple-500"}),"Destination City"]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:D,onChange:s=>{y(s.target.value),v(!0)},onFocus:()=>v(!0),className:"w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",placeholder:"Search destination city...",required:!0}),V&&M.length>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-lg",children:M.map(s=>e.jsxs("li",{onClick:()=>A("destination",s),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[s.name,", ",s.state," (ID: ",s.id,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(re,{size:20,className:"mr-2 text-indigo-500"}),"Booking Type"]}),e.jsxs("select",{name:"bookingType",value:t.bookingType,onChange:n,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"ONLINE",children:"Online"}),e.jsx("option",{value:"OFFLINE",children:"Offline"}),e.jsx("option",{value:"STANDARD",children:"Standard"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(L,{size:20,className:"mr-2 text-teal-500"}),"Service Charge"]}),e.jsx("input",{type:"number",name:"serviceCharge",value:t.serviceCharge,onChange:n,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",min:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(L,{size:20,className:"mr-2 text-orange-500"}),"Payment Mode"]}),e.jsxs("select",{name:"paymentMode",value:t.paymentMode,onChange:n,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CARD",children:"Card"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"NETBANKING",children:"Netbanking"})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(ee,{size:20,className:"mr-2 text-gray-600"}),"Passenger Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Seat Name"}),e.jsx("input",{type:"text",name:"inventoryItems.0.seatName",value:t.inventoryItems[0].seatName,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Fare"}),e.jsx("input",{type:"number",name:"inventoryItems.0.fare",value:t.inventoryItems[0].fare,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0,min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Service Tax"}),e.jsx("input",{type:"number",name:"inventoryItems.0.serviceTax",value:t.inventoryItems[0].serviceTax,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Operator Service Charge"}),e.jsx("input",{type:"number",name:"inventoryItems.0.operatorServiceCharge",value:t.inventoryItems[0].operatorServiceCharge,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Ladies Seat"}),e.jsxs("select",{name:"inventoryItems.0.ladiesSeat",value:t.inventoryItems[0].ladiesSeat,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"false",children:"No"}),e.jsx("option",{value:"true",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Name"}),e.jsx("input",{type:"text",name:"inventoryItems.0.passenger.name",value:t.inventoryItems[0].passenger.name,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Mobile"}),e.jsx("input",{type:"number",name:"inventoryItems.0.passenger.mobile",value:t.inventoryItems[0].passenger.mobile,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Title"}),e.jsxs("select",{name:"inventoryItems.0.passenger.title",value:t.inventoryItems[0].passenger.title,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"Mr",children:"Mr"}),e.jsx("option",{value:"Ms",children:"Ms"}),e.jsx("option",{value:"Mrs",children:"Mrs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"inventoryItems.0.passenger.email",value:t.inventoryItems[0].passenger.email,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Age"}),e.jsx("input",{type:"number",name:"inventoryItems.0.passenger.age",value:t.inventoryItems[0].passenger.age,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Gender"}),e.jsxs("select",{name:"inventoryItems.0.passenger.gender",value:t.inventoryItems[0].passenger.gender,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"MALE",children:"Male"}),e.jsx("option",{value:"FEMALE",children:"Female"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Address"}),e.jsx("input",{type:"text",name:"inventoryItems.0.passenger.address",value:t.inventoryItems[0].passenger.address,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"ID Type"}),e.jsx("input",{type:"text",name:"inventoryItems.0.passenger.idType",value:t.inventoryItems[0].passenger.idType,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"ID Number"}),e.jsx("input",{type:"text",name:"inventoryItems.0.passenger.idNumber",value:t.inventoryItems[0].passenger.idNumber,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:"Primary Passenger"}),e.jsxs("select",{name:"inventoryItems.0.passenger.primary",value:t.inventoryItems[0].passenger.primary,onChange:s=>n(s,0),className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"0",children:"No"}),e.jsx("option",{value:"1",children:"Yes"})]})]})]})]}),e.jsx("button",{type:"submit",disabled:C||m,className:"w-full bg-gray-800 text-white py-3 px-4 rounded-lg hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:C?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Blocking Ticket..."]}):"Block Ticket"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[Object.keys(N).length>0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-100 rounded-lg",children:e.jsxs("p",{className:"text-red-600 text-sm flex items-center",children:[e.jsx(te,{size:16,className:"mr-2"}),Object.values(N)[0]]})}),T&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-100 rounded-lg",children:e.jsxs("p",{className:"text-green-600 text-sm flex items-center",children:[e.jsx(ae,{size:16,className:"mr-2"}),T]})})]})]})})})};export{be as default};
