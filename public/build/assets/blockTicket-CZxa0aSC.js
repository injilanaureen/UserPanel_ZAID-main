import{r as v,a as S,j as e,S as k}from"./app-DMvSxdSr.js";import{A as P,U as b}from"./AdminLayout-CZdNJQUq.js";import{B as D}from"./bus-DkILpOhQ.js";import{M as j}from"./map-pin-cQNXbHMY.js";import{T as y}from"./ticket-2CM7t4ru.js";import{C as u}from"./credit-card-BgCp_QBx.js";import{C as z}from"./circle-alert-Drcw10cE.js";import{C as w}from"./circle-check-big-CNqkqUoK.js";import"./x-X3WPSQvq.js";import"./createLucideIcon-DU2LoeeI.js";import"./log-out-DTFVTVf_.js";const c="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",m=({label:h,icon:o,children:g,error:a})=>e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[o," ",h]}),g,a&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a})]}),Y=()=>{const h={availableTripId:"",boardingPointId:"",droppingPointId:"",source:"",destination:"",bookingType:"ONLINE",serviceCharge:"",paymentMode:"CASH",inventoryItems:[{seatName:"",fare:"",serviceTax:"",operatorServiceCharge:"",ladiesSeat:"false",passenger:{name:"",mobile:"",title:"Mr",email:"",age:"",gender:"MALE",address:"",idType:"PANCARD",idNumber:"",primary:"0"}}]},[o,g]=v.useState(h),[a,d]=v.useState({errors:{},loading:!1,pointsLoading:!1,boardingPoints:[],droppingPoints:[],selectedBoardingAddress:"",selectedDroppingAddress:"",success:"",availableSeats:[],sourceCities:[],citiesLoading:!1});v.useEffect(()=>{I()},[]),v.useEffect(()=>{o.availableTripId&&T()},[o.availableTripId]);const I=async()=>{var s;d(r=>({...r,citiesLoading:!0}));try{const r=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),i=await S.get("/admin/busTicket/fetchSourceCities",{headers:{Accept:"application/json","X-CSRF-TOKEN":r}});if(console.log("Source Cities Response:",i.data),i.data.status&&i.data.data.cities)d(l=>({...l,sourceCities:i.data.data.cities}));else throw new Error("Invalid response structure")}catch(r){console.error("Fetch Source Cities Error:",r.response||r.message),d(i=>{var l,t;return{...i,errors:{cities:"Failed to load source cities: "+(((t=(l=r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message)}}})}finally{d(r=>({...r,citiesLoading:!1}))}},T=async()=>{var s;d(r=>({...r,pointsLoading:!0}));try{const r=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"),{data:i}=await S.post("/admin/busTicket/fetchTripDetails",{trip_id:o.availableTripId},{headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":r}});if(i.status&&i.data){const t=(i.data.seats||[]).map(n=>{var x,C;return{seatName:n.name,fare:n.fare.toString(),serviceTax:((x=n.serviceTaxAbsolute)==null?void 0:x.toString())||"0",operatorServiceCharge:((C=n.operatorServiceChargeAbsolute)==null?void 0:C.toString())||"0",ladiesSeat:n.ladiesSeat==="true"?"true":"false"}});d(n=>({...n,boardingPoints:i.data.boardingTimes||[],droppingPoints:i.data.droppingTimes||[],availableSeats:t})),t.length>0&&g(n=>({...n,serviceCharge:(i.data.agentServiceCharge||"0").toString(),inventoryItems:[{...n.inventoryItems[0],seatName:t[0].seatName,fare:t[0].fare,serviceTax:t[0].serviceTax,operatorServiceCharge:t[0].operatorServiceCharge,ladiesSeat:t[0].ladiesSeat}]}))}}catch{d(i=>({...i,errors:{tripDetails:"Failed to load trip details"}}))}finally{d(r=>({...r,pointsLoading:!1}))}},p=(s,r=0)=>{const{name:i,value:l}=s.target;if(d(t=>({...t,errors:{},success:""})),i.includes("passenger.")){const t=i.split("passenger.")[1];f(r,"passenger",t,l)}else i.includes("inventoryItems.")?f(r,null,i.split(".")[2],l):g(t=>({...t,[i]:l}))},f=(s,r,i,l)=>{g(t=>({...t,inventoryItems:t.inventoryItems.map((n,x)=>x===s?r?{...n,[r]:{...n[r],[i]:l}}:{...n,[i]:l}:n)}))},N=s=>r=>{const i=r.target.value;d(n=>({...n,[s==="boarding"?"selectedBoardingAddress":"selectedDroppingAddress"]:i}));const t=(s==="boarding"?a.boardingPoints:a.droppingPoints).find(n=>n.address===i);t&&g(n=>({...n,[s+"PointId"]:t.bpId}))},A=(s,r=0)=>{const i=s.target.value,l=a.availableSeats.find(t=>t.seatName===i);l&&g(t=>({...t,inventoryItems:t.inventoryItems.map((n,x)=>x===r?{...n,seatName:l.seatName,fare:l.fare,serviceTax:l.serviceTax,operatorServiceCharge:l.operatorServiceCharge,ladiesSeat:l.ladiesSeat}:n)}))},L=s=>{if(s.preventDefault(),!o.source||!o.destination){d(r=>({...r,errors:{source:"Please select both source and destination"}}));return}d(r=>({...r,loading:!0,errors:{},success:""})),console.log("Form Data Submitted:",JSON.stringify(o,null,2)),k.post("/admin/bus-ticket/block/api",o,{onSuccess:()=>{d(r=>({...r,loading:!1,success:"Ticket blocked successfully!"})),g(h),d(r=>({...r,selectedBoardingAddress:"",selectedDroppingAddress:""}))},onError:r=>d(i=>({...i,loading:!1,errors:r}))})};return e.jsx(P,{children:e.jsx("div",{className:"max-w-full",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Reserve Bus Ticket"})}),e.jsxs("form",{onSubmit:L,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsx(m,{label:"Available Trip ID",icon:e.jsx(D,{size:20,className:"mr-2 text-green-500"}),error:a.errors.availableTripId,children:e.jsx("input",{type:"text",name:"availableTripId",value:o.availableTripId,onChange:p,className:c,required:!0})}),e.jsx(m,{label:"Boarding Point",icon:e.jsx(j,{size:20,className:"mr-2 text-yellow-500"}),error:a.errors.boardingPointId,children:e.jsxs("select",{value:a.selectedBoardingAddress,onChange:N("boarding"),className:c,disabled:!o.availableTripId||a.pointsLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select boarding point"},"default"),a.pointsLoading?e.jsx("option",{children:"Loading..."}):a.boardingPoints.map((s,r)=>e.jsxs("option",{value:s.address,children:[s.address," (ID: ",s.bpId,")"]},r))]})}),e.jsx(m,{label:"Dropping Point",icon:e.jsx(j,{size:20,className:"mr-2 text-red-500"}),error:a.errors.droppingPointId,children:e.jsxs("select",{value:a.selectedDroppingAddress,onChange:N("dropping"),className:c,disabled:!o.availableTripId||a.pointsLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select dropping point"},"default"),a.pointsLoading?e.jsx("option",{children:"Loading..."}):a.droppingPoints.map((s,r)=>e.jsxs("option",{value:s.address,children:[s.address," (ID: ",s.bpId,")"]},r))]})}),e.jsx(m,{label:"Source",icon:e.jsx(j,{size:20,className:"mr-2 text-blue-500"}),error:a.errors.source,children:e.jsxs("select",{name:"source",value:o.source,onChange:p,className:c,disabled:a.citiesLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select source city"}),a.citiesLoading?e.jsx("option",{children:"Loading cities..."}):a.sourceCities.length===0?e.jsx("option",{children:"No cities available"}):a.sourceCities.map(s=>e.jsxs("option",{value:s.id.toString(),children:[s.name,", ",s.state]},s.id))]})}),e.jsx(m,{label:"Destination",icon:e.jsx(j,{size:20,className:"mr-2 text-purple-500"}),error:a.errors.destination,children:e.jsxs("select",{name:"destination",value:o.destination,onChange:p,className:c,disabled:a.citiesLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select destination city"}),a.citiesLoading?e.jsx("option",{children:"Loading cities..."}):a.sourceCities.length===0?e.jsx("option",{children:"No cities available"}):a.sourceCities.map(s=>e.jsxs("option",{value:s.id.toString(),children:[s.name,", ",s.state]},s.id))]})}),e.jsx(m,{label:"Booking Type",icon:e.jsx(y,{size:20,className:"mr-2 text-indigo-500"}),error:a.errors.bookingType,children:e.jsxs("select",{name:"bookingType",value:o.bookingType,onChange:p,className:c,children:[e.jsx("option",{value:"ONLINE",children:"Online"}),e.jsx("option",{value:"OFFLINE",children:"Offline"}),e.jsx("option",{value:"STANDARD",children:"Standard"})]})}),e.jsx(m,{label:"Service Charge",icon:e.jsx(u,{size:20,className:"mr-2 text-teal-500"}),error:a.errors.serviceCharge,children:e.jsx("input",{type:"number",name:"serviceCharge",value:o.serviceCharge,onChange:p,className:c,min:"0",disabled:a.pointsLoading})}),e.jsx(m,{label:"Payment Mode",icon:e.jsx(u,{size:20,className:"mr-2 text-orange-500"}),error:a.errors.paymentMode,children:e.jsxs("select",{name:"paymentMode",value:o.paymentMode,onChange:p,className:c,children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CARD",children:"Card"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"NETBANKING",children:"Netbanking"})]})})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),"Passenger Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Seat Name",icon:e.jsx(y,{size:20,className:"mr-2 text-gray-600"}),error:a.errors["inventoryItems.0.seatName"],children:e.jsxs("select",{name:"inventoryItems.0.seatName",value:o.inventoryItems[0].seatName,onChange:s=>A(s),className:c,disabled:!a.availableSeats.length,required:!0,children:[e.jsx("option",{value:"",children:"Select a seat"},"default"),a.availableSeats.length===0?e.jsx("option",{value:"",children:"No seats available"}):a.availableSeats.map((s,r)=>e.jsxs("option",{value:s.seatName,children:[s.seatName," (â‚¹",s.fare,")"]},r))]})}),e.jsx(m,{label:"Fare",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:a.errors["inventoryItems.0.fare"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.fare",value:o.inventoryItems[0].fare,onChange:p,className:c,min:"0",readOnly:!0})}),e.jsx(m,{label:"Service Tax",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:a.errors["inventoryItems.0.serviceTax"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.serviceTax",value:o.inventoryItems[0].serviceTax,onChange:p,className:c,min:"0",readOnly:!0})}),e.jsx(m,{label:"Operator Service Charge",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:a.errors["inventoryItems.0.operatorServiceCharge"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.operatorServiceCharge",value:o.inventoryItems[0].operatorServiceCharge,onChange:p,className:c,min:"0",readOnly:!0})}),e.jsx(m,{label:"Ladies Seat",icon:e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),error:a.errors["inventoryItems.0.ladiesSeat"],children:e.jsxs("select",{name:"inventoryItems.0.ladiesSeat",value:o.inventoryItems[0].ladiesSeat,onChange:p,className:c,disabled:!0,children:[e.jsx("option",{value:"false",children:"No"}),e.jsx("option",{value:"true",children:"Yes"})]})}),Object.entries(o.inventoryItems[0].passenger).map(([s,r])=>e.jsx(m,{label:s.charAt(0).toUpperCase()+s.slice(1),icon:e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),error:a.errors[`inventoryItems.0.passenger.${s}`],children:s==="idType"?e.jsxs("select",{name:`inventoryItems.0.passenger.${s}`,value:r,onChange:p,className:c,required:!0,children:[e.jsx("option",{value:"PANCARD",children:"Pancard"}),e.jsx("option",{value:"AADHAAR",children:"Aadhaar Card"})]}):["title","gender","primary"].includes(s)?e.jsxs("select",{name:`inventoryItems.0.passenger.${s}`,value:r,onChange:p,className:c,children:[s==="title"&&["Mr","Ms","Mrs"].map(i=>e.jsx("option",{value:i,children:i},i)),s==="gender"&&["MALE","FEMALE"].map(i=>e.jsx("option",{value:i,children:i},i)),s==="primary"&&["0","1"].map(i=>e.jsx("option",{value:i,children:i==="0"?"No":"Yes"},i))]}):e.jsx("input",{type:s==="email"?"email":s==="age"||s==="mobile"?"number":"text",name:`inventoryItems.0.passenger.${s}`,value:r,onChange:p,className:c,...s==="age"?{min:1}:{},required:["name","mobile","age"].includes(s)})},s))]})]}),e.jsx("button",{type:"submit",disabled:a.loading||a.pointsLoading||a.citiesLoading,className:"w-full bg-gray-800 text-white py-3 px-4 rounded-lg hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:a.loading?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 8.291l5.657-5.657C13.536 13.755 12.768 12 10.34 12H6c0-1.659.635-3.155 1.657-4.243C8.219 6.863 9.396 6.18 10.725 6.039 10.9 6.687 10.568 6.997 11 7c-0.031 0.001-0.326 0.016-0.743 0.656C11.091 7.891 12 8.973 12 10.7c0 2.172-1.7 4.257-4.8 7.2l1.086 1.623L12 18c2.333 0 4.167 1 5.5 3h-1c-1.167-1.5-2.667-2.167-4.5-2z"})]}),"Blocking Ticket..."]}):"Block Ticket"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[Object.keys(a.errors).length>0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-100 rounded-lg",children:e.jsxs("p",{className:"text-red-600 text-sm flex items-center",children:[e.jsx(z,{size:16,className:"mr-2"}),Object.values(a.errors)[0]]})}),a.success&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-100 rounded-lg",children:e.jsxs("p",{className:"text-green-600 text-sm flex items-center",children:[e.jsx(w,{size:16,className:"mr-2"}),a.success]})})]})]})})})};export{Y as default};
