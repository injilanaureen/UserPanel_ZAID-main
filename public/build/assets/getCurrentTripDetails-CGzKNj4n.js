import{r as o,j as e}from"./app-C9Hasp1L.js";import{A as w}from"./AdminLayout-dj7iNOPP.js";import{L as S}from"./loader-circle-J9skaEJy.js";import"./x-o7aJ_J0I.js";import"./createLucideIcon-BHfLX7CN.js";const F=()=>{var j,N;const[l,f]=o.useState(""),[b,u]=o.useState(!1),[h,c]=o.useState(null),[a,x]=o.useState(null),[d,m]=o.useState(null),g=()=>{var s;return(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content")},y=s=>{let r=[];if(s.boardingTimes){if(typeof s.boardingTimes=="object"&&!Array.isArray(s.boardingTimes))r=Object.values(s.boardingTimes);else if(Array.isArray(s.boardingTimes))r=s.boardingTimes;else if(typeof s.boardingTimes=="string")try{r=JSON.parse(s.boardingTimes),typeof r=="object"&&!Array.isArray(r)&&(r=Object.values(r))}catch(n){console.error("Failed to parse boardingTimes:",n),r=[]}}r=r.map(n=>({id:n.bpId,name:n.bpName||n.name||"Unknown Location",address:n.address||"No address provided",city:n.city||"Unknown City",contactNumber:n.contactNumber||n.contact||null,landmark:n.landmark||null,time:parseInt(n.time)||0,isPrime:n.prime==="true"})).sort((n,v)=>n.time-v.time);const t=r.find(n=>n.isPrime)||r[0];let i=[];if(s.passengers){if(typeof s.passengers=="object"&&!Array.isArray(s.passengers))i=Object.values(s.passengers);else if(Array.isArray(s.passengers))i=s.passengers;else if(typeof s.passengers=="string")try{i=JSON.parse(s.passengers),typeof i=="object"&&!Array.isArray(i)&&(i=Object.values(i))}catch(n){console.error("Failed to parse passengers:",n),i=[]}}return i=i.map(n=>({name:n.name||"Unknown",age:n.age||"0",gender:n.gender||"Not Specified",seatNumber:n.seatNumber||"Not Assigned",fare:n.fare||"0",status:n.status||"Confirmed",idType:n.idType||null,idNumber:n.idNumber||null})),{pnrNumber:s.pnrNumber||"N/A",bookingId:s.bookingId||"N/A",travelDate:s.travelDate||"N/A",status:s.status||"Unknown",operatorName:s.operatorName||"Unknown Operator",busType:s.busType||"Standard",source:s.source||"N/A",destination:s.destination||"N/A",departureTime:(t==null?void 0:t.time)||0,boardingTime:(t==null?void 0:t.time)||0,boardingPoint:(t==null?void 0:t.name)||"N/A",duration:s.duration||"0",totalFare:s.totalFare||"0",boardingPoints:r,passengers:i,additionalInfo:s.additionalInfo||null,cancellationPolicy:s.cancellationPolicy||null,partialCancellationAllowed:s.partialCancellationAllowed||!1,operatorContact:s.operatorContact||null,operatorAddress:s.operatorAddress||null}},T=async s=>{try{const r=s.boardingPoints.map(n=>({location:n.name||"Unknown Location",address:n.address||"No address provided",city:n.city||"Unknown City",time:n.time||0,landmark:n.landmark||"No landmark",contact:n.contactNumber||"No contact"}));console.log("Sending trip details:",{trip_id:l,boarding_points:r});const i=await(await fetch("/admin/busTicket/storeTripDetails",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":g()},body:JSON.stringify({trip_id:l,boarding_points:r})})).json();if(console.log("Store trip details response:",i),!i.status)throw new Error(i.message||"Failed to save trip details");m({type:"success",message:"Trip details saved successfully"})}catch(r){console.error("Error storing trip details:",r),m({type:"error",message:`Error storing trip details: ${r.message||"Unknown error"}`})}},A=async()=>{if(!l){c("Please enter a Trip ID.");return}u(!0),c(null),x(null),m(null);try{const s=await fetch("/admin/busTicket/fetchTripDetails",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":g()},body:JSON.stringify({trip_id:l})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();if(!r.status)throw new Error(r.message||"Failed to fetch trip details");console.log("API Response:",r),console.log("API Data:",r.data),console.log("Boarding Times Type:",typeof r.data.boardingTimes),r.data.boardingTimes&&console.log("Boarding Times Value:",r.data.boardingTimes);const t=y(r.data);console.log("Transformed Data:",t),x(t),await T(t)}catch(s){console.error("Error details:",s),c(s.message||"Failed to load trip details")}u(!1)},p=s=>{if(s==null)return"N/A";const r=Math.floor(s/60),t=s%60;return`${r.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`};return e.jsx(w,{children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6 mb-4",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Enter Trip ID"})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"text",className:"border rounded-lg px-4 py-2 w-full",placeholder:"Enter Trip ID...",value:l,onChange:s=>f(s.target.value)}),e.jsx("button",{className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600",onClick:A,children:"Fetch Details"})]})]}),b&&e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx(S,{className:"animate-spin h-8 w-8 text-blue-500"})}),h&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:h})}),d&&e.jsx("div",{className:`p-4 border rounded-lg ${d.type==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsx("p",{className:d.type==="success"?"text-green-600":"text-red-600",children:d.message})}),a&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Current Trip Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Journey Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"PNR:"})," ",a.pnrNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Booking ID:"})," ",a.bookingId]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Travel Date:"})," ",a.travelDate]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",a.status]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Bus Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Operator:"})," ",a.operatorName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Bus Type:"})," ",a.busType]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"From:"})," ",a.source]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"To:"})," ",a.destination]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Timing Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Departure:"})," ",p(a.departureTime)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",a.duration," mins"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Boarding Point:"})," ",a.boardingPoint]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Boarding Time:"})," ",p(a.boardingTime)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Fare Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Fare:"})," â‚¹",a.totalFare]})]})]}),((j=a.passengers)==null?void 0:j.length)>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Passenger Details"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.passengers.map((s,r)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Age:"})," ",s.age]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Gender:"})," ",s.gender]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Seat Number:"})," ",s.seatNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",s.status]})]},r))})]}),((N=a.boardingPoints)==null?void 0:N.length)>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All Boarding Points"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.boardingPoints.map((s,r)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"City:"})," ",s.city]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",p(s.time)]}),s.landmark&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Landmark:"})," ",s.landmark]}),s.contactNumber&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",s.contactNumber]}),s.isPrime&&e.jsx("p",{className:"text-blue-600 font-medium",children:"Primary Boarding Point"})]},s.id||r))})]}),a.additionalInfo&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Additional Information"}),e.jsx("p",{children:a.additionalInfo})]}),a.cancellationPolicy&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellation Policy"}),e.jsx("p",{children:a.cancellationPolicy}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Partial Cancellation:"})," ",a.partialCancellationAllowed?"Allowed":"Not Allowed"]})]}),(a.operatorContact||a.operatorAddress)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Operator Details"}),a.operatorContact&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",a.operatorContact]}),a.operatorAddress&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",a.operatorAddress]})]})]})]})})};export{F as default};
