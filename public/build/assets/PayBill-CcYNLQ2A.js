import{r as t,a as v,j as e}from"./app-aElpIP4z.js";import{A as O}from"./AdminLayout-jtBnNJDU.js";import{S as w}from"./signal-B90p72Mv.js";import{C as z}from"./code-VxEQnoD5.js";import{P as D}from"./phone-CbRkaR8Y.js";import{C as k}from"./circle-alert-tr_bmzrM.js";import"./x-DxLt2K9m.js";import"./createLucideIcon-eQcrBYIH.js";import"./log-out-DnjRdJ6V.js";const G=()=>{const[R,L]=t.useState(""),[B,q]=t.useState(""),[d,S]=t.useState([]),[C,x]=t.useState(!0),[u,p]=t.useState(null),[g,h]=t.useState(null),[b,i]=t.useState(null),[y,f]=t.useState(!1),[a,j]=t.useState(null),[s,F]=t.useState({operator:"",canumber:"",amount:""});t.useEffect(()=>{x(!0),v.get("/api/operators").then(r=>{r.data.success?S(r.data.operators):p(r.data.message)}).catch(r=>p("Failed to fetch operators")).finally(()=>x(!1))},[]),t.useEffect(()=>{if(s.operator){const r=d.find(n=>n.id===s.operator);j(r||null)}else j(null)},[s.operator,d]);const c=r=>{const{name:n,value:o}=r.target;F(m=>({...m,[n]:o}))},P=async r=>{var n,o,m,N;if(r.preventDefault(),!s.operator){i("Please select an operator");return}if(!s.canumber.trim()){i("Please enter a consumer number");return}if(!s.amount.trim()||isNaN(s.amount)||parseFloat(s.amount)<=0){i("Please enter a valid amount");return}try{f(!0),i(null),h(null);const l=await v.post("/admin/utility-bill-payment/process-bill-payment",{canumber:s.canumber.trim(),amount:parseFloat(s.amount.trim()),operator:s.operator});if(l.data.status===!1)throw new Error(l.data.message||"Payment failed");h(l.data)}catch(l){console.error("Payment Error:",l);const A=((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.error)||((N=(m=l.response)==null?void 0:m.data)==null?void 0:N.message)||l.message||"An unexpected error occurred during payment processing";i(A)}finally{f(!1)}},E=({data:r})=>{var n;return e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-green-50 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Payment Details"})}),e.jsx("div",{className:"p-4",children:e.jsx("table",{className:"w-full text-sm text-left text-gray-700",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50 w-1/3",children:"Status"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                  ${r.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.status?"Successful":"Failed"})})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Amount"}),e.jsxs("td",{className:"py-3 px-4",children:["₹",parseFloat(s.amount).toFixed(2)]})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Operator"}),e.jsx("td",{className:"py-3 px-4",children:((n=d.find(o=>o.id===s.operator))==null?void 0:n.name)||s.operator})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Response Code"}),e.jsx("td",{className:"py-3 px-4",children:r.response_code})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Operator ID"}),e.jsx("td",{className:"py-3 px-4",children:r.operatorid})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Acknowledgement No"}),e.jsx("td",{className:"py-3 px-4",children:r.ackno})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Reference ID"}),e.jsx("td",{className:"py-3 px-4",children:r.refid})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50 align-top",children:"Message"}),e.jsx("td",{className:"py-3 px-4",children:r.message})]})]})})})]})};return e.jsx(O,{children:e.jsx("div",{className:"max-w-full p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Pay Utility Bill"})}),e.jsxs("form",{onSubmit:P,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"operator",className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(w,{size:20,className:"mr-2 text-green-500"}),"Operator :"]}),C?e.jsx("div",{className:"text-gray-500",children:"Loading operators..."}):u?e.jsx("div",{className:"text-red-500",children:u}):e.jsxs("select",{id:"operator",name:"operator",value:s.operator,onChange:c,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0,children:[e.jsx("option",{value:"",children:"Select Operator"}),d.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),a&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsxs("h3",{className:"font-medium text-blue-700 mb-2 flex items-center",children:[e.jsx(z,{size:16,className:"mr-2"}),"Operator Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Category:"})," ",a.category]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Field Name:"})," ",a.displayname]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Regex:"})," ",e.jsx("span",{className:"text-gray-600 text-xs",children:a.regex})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"canumber",className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(D,{size:20,className:"mr-2 text-yellow-500"}),a?a.displayname:"Consumer Number"]}),e.jsx("input",{id:"canumber",name:"canumber",value:s.canumber,onChange:c,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0,pattern:a==null?void 0:a.regex,title:a?`Format must match: ${a.regex}`:"",placeholder:`Enter ${a?a.displayname:"Consumer Number"}`}),a&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Format: ",a.regex]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"amount",className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[e.jsx(w,{size:20,className:"mr-2 text-blue-500"}),"Amount (₹)"]}),e.jsx("input",{id:"amount",name:"amount",type:"number",min:"1",step:"0.01",value:s.amount,onChange:c,className:"w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",required:!0,placeholder:"Enter payment amount"})]})]}),e.jsx("button",{type:"submit",disabled:y||!s.operator||!s.canumber||!s.amount||isNaN(s.amount)||parseFloat(s.amount)<=0,className:"w-full bg-gray-800 text-white py-3 px-4 rounded-lg hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:y?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Pay Bill"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[g&&e.jsx(E,{data:g}),b&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{size:20,className:"mr-2 text-red-500"}),e.jsx("div",{className:"text-lg font-semibold text-red-800",children:"Error"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-2",children:b})]})]})]})})})};export{G as default};
