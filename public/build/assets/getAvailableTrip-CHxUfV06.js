import{r,j as e}from"./app-gHG3FWNm.js";import{A as T}from"./AdminLayout-ig8rvVGB.js";import{R as S}from"./receipt-BRtzLCER.js";import{L as w,S as F}from"./ship-wheel-BLi90BBY.js";import{L as A}from"./loader-circle-4_K4xCGv.js";import"./x-Dij5_qHA.js";import"./createLucideIcon-Cehs4-sn.js";const k=()=>{const[c,j]=r.useState({source_id:"",destination_id:"",date_of_journey:""}),[i,h]=r.useState([]),[o,p]=r.useState(!1),[g,m]=r.useState(null),[t,f]=r.useState({busType:"",availability:"",fareRange:""}),u=s=>{const{name:a,value:l}=s.target;j(n=>({...n,[a]:l})),m(null)},x=s=>{const{name:a,value:l}=s.target;f(n=>({...n,[a]:l}))},b=async s=>{s.preventDefault(),p(!0),m(null),h([]);try{const a=await fetch("/admin/busTicket/fetchAvailableTrips",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(c)}),l=await a.json();if(!a.ok)throw new Error(l.message||`HTTP error! status: ${a.status}`);h(l.data.availableTrips)}catch(a){m(a.message||"Failed to fetch trips. Please try again.")}finally{p(!1)}},N=()=>i?i.filter(s=>{const a=!t.busType||s.busType===t.busType,l=parseInt(s.availableSeats),n=!t.availability||t.availability==="1-5"&&l<=5||t.availability==="6-10"&&l>5&&l<=10||t.availability==="11-20"&&l>10&&l<=20||t.availability==="21+"&&l>20,d=parseFloat(s.fares),v=!t.fareRange||t.fareRange==="low"&&d<=50||t.fareRange==="medium"&&d>50&&d<=200||t.fareRange==="high"&&d>200;return a&&n&&v}):[],y=()=>i?[...new Set(i.map(s=>s.busType))]:[];return e.jsx(T,{children:e.jsxs("div",{className:"max-w-full",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Search Available Bus Trips"})}),e.jsxs("form",{onSubmit:b,className:"space-y-4 mb-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(S,{size:20,className:"text-green-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Source ID:"})]}),e.jsx("input",{type:"number",name:"source_id",value:c.source_id,onChange:u,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{size:20,className:"text-yellow-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Destination ID:"})]}),e.jsx("input",{type:"number",name:"destination_id",value:c.destination_id,onChange:u,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(F,{size:20,className:"text-red-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Date of Journey:"})]}),e.jsx("input",{type:"date",name:"date_of_journey",value:c.date_of_journey,onChange:u,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",required:!0,min:new Date().toISOString().split("T")[0]})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:o?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-5 w-5 animate-spin mr-2"}),"Searching..."]}):"Search Trips"})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-600",children:g})}),i.length>0&&!o&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Available Trips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("select",{name:"busType",value:t.busType,onChange:x,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Bus Types"}),y().map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{name:"availability",value:t.availability,onChange:x,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Availabilities"}),e.jsx("option",{value:"1-5",children:"1-5 Seats"}),e.jsx("option",{value:"6-10",children:"6-10 Seats"}),e.jsx("option",{value:"11-20",children:"11-20 Seats"}),e.jsx("option",{value:"21+",children:"21+ Seats"})]}),e.jsxs("select",{name:"fareRange",value:t.fareRange,onChange:x,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Fare Ranges"}),e.jsx("option",{value:"low",children:"Low Fare (≤₹50)"}),e.jsx("option",{value:"medium",children:"Medium Fare (₹51-₹200)"}),e.jsx("option",{value:"high",children:"High Fare (Above ₹200)"})]})]}),e.jsx("div",{className:"space-y-4",children:N().map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Bus Type"}),e.jsx("p",{className:"font-medium",children:s.busType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Available Seats"}),e.jsx("p",{className:"font-medium",children:s.availableSeats})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fare"}),e.jsxs("p",{className:"font-medium",children:["₹",s.fares]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("p",{className:"font-medium",children:s.duration})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Boarding Points:"}),Array.isArray(s.boardingTimes)?s.boardingTimes.map((a,l)=>e.jsxs("p",{className:"font-medium",children:[a.bpName," - ",a.address," (Contact: ",a.contactNumber,")"]},l)):e.jsxs("p",{className:"font-medium",children:[s.boardingTimes.bpName," - ",s.boardingTimes.address," (Contact: ",s.boardingTimes.contactNumber,")"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Dropping Point:"}),e.jsxs("p",{className:"font-medium",children:[s.droppingTimes.bpName," - ",s.droppingTimes.address," (Contact: ",s.droppingTimes.contactNumber,")"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Cancellation Policy:"}),e.jsx("p",{className:"font-medium",children:s.cancellationPolicy})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fare Details:"}),e.jsxs("div",{className:"border-t pt-2",children:[e.jsxs("p",{className:"font-medium",children:["Base Fare: ₹",s.fareDetails.baseFare]}),e.jsxs("p",{className:"font-medium",children:["GST: ₹",s.fareDetails.gst]}),e.jsxs("p",{className:"font-medium",children:["Total Fare: ₹",s.fareDetails.totalFare]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Operator:"}),e.jsx("p",{className:"font-medium",children:s.operator})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Travel Company:"}),e.jsx("p",{className:"font-medium",children:s.travels})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date of Journey:"}),e.jsx("p",{className:"font-medium",children:new Date(s.doj).toLocaleDateString()})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Departure Time:"}),e.jsx("p",{className:"font-medium",children:s.departureTime})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Arrival Time:"}),e.jsx("p",{className:"font-medium",children:s.arrivalTime})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vehicle Type:"}),e.jsx("p",{className:"font-medium",children:s.vehicleType})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vaccinated Bus:"}),e.jsx("p",{className:"font-medium",children:s.vaccinatedBus?"Yes":"No"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vaccinated Staff:"}),e.jsx("p",{className:"font-medium",children:s.vaccinatedStaff?"Yes":"No"})]})]},s.id))})]})]})})};export{k as default};
