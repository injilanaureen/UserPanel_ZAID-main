import{r as j,a as A,j as e,S as k}from"./app-CIvKDUKi.js";import{A as P,U as b}from"./AdminLayout-Ds4fEKQq.js";import{B as D}from"./bus-BDLyX8Mn.js";import{M as v}from"./map-pin-C0J8cdRS.js";import{T as C}from"./ticket-Bq-NatLP.js";import{C as u}from"./credit-card-C1zFskEP.js";import{C as L}from"./circle-alert-DmN9lXKz.js";import{C as z}from"./circle-check-big-B4T5nBVb.js";import"./x-ATu5mHak.js";import"./createLucideIcon-BKFYTc62.js";import"./log-out-CSXaC4I1.js";const l="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all",c=({label:h,icon:o,children:g,error:r})=>e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-600 mb-1",children:[o," ",h]}),g,r&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r})]}),Y=()=>{const h={availableTripId:"",boardingPointId:"",droppingPointId:"",source:"",destination:"",bookingType:"ONLINE",serviceCharge:"",paymentMode:"CASH",inventoryItems:[{seatName:"",fare:"",serviceTax:"",operatorServiceCharge:"",ladiesSeat:"false",passenger:{name:"",mobile:"",title:"Mr",email:"",age:"",gender:"MALE",address:"",idType:"PANCARD",idNumber:"",primary:"0"}}]},[o,g]=j.useState(h),[r,p]=j.useState({errors:{},loading:!1,pointsLoading:!1,boardingPoints:[],droppingPoints:[],selectedBoardingAddress:"",selectedDroppingAddress:"",success:"",availableSeats:[]});j.useEffect(()=>{o.availableTripId&&S()},[o.availableTripId]);const S=async()=>{var a;p(s=>({...s,pointsLoading:!0}));try{const s=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"),{data:t}=await A.post("/admin/busTicket/fetchTripDetails",{trip_id:o.availableTripId},{headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":s}});if(t.status&&t.data){const i=(t.data.seats||[]).map(n=>{var x,y;return{seatName:n.name,fare:n.fare.toString(),serviceTax:((x=n.serviceTaxAbsolute)==null?void 0:x.toString())||"0",operatorServiceCharge:((y=n.operatorServiceChargeAbsolute)==null?void 0:y.toString())||"0",ladiesSeat:n.ladiesSeat==="true"?"true":"false"}});p(n=>({...n,boardingPoints:t.data.boardingTimes||[],droppingPoints:t.data.droppingTimes||[],availableSeats:i})),i.length>0&&g(n=>({...n,serviceCharge:(t.data.agentServiceCharge||"0").toString(),inventoryItems:[{...n.inventoryItems[0],seatName:i[0].seatName,fare:i[0].fare,serviceTax:i[0].serviceTax,operatorServiceCharge:i[0].operatorServiceCharge,ladiesSeat:i[0].ladiesSeat}]}))}}catch{p(t=>({...t,errors:{tripDetails:"Failed to load trip details"}}))}finally{p(s=>({...s,pointsLoading:!1}))}},m=(a,s=0)=>{const{name:t,value:d}=a.target;if(p(i=>({...i,errors:{},success:""})),t.includes("passenger.")){const i=t.split("passenger.")[1];N(s,"passenger",i,d)}else t.includes("inventoryItems.")?N(s,null,t.split(".")[2],d):g(i=>({...i,[t]:d}))},N=(a,s,t,d)=>{g(i=>({...i,inventoryItems:i.inventoryItems.map((n,x)=>x===a?s?{...n,[s]:{...n[s],[t]:d}}:{...n,[t]:d}:n)}))},f=a=>s=>{const t=s.target.value;p(n=>({...n,[a==="boarding"?"selectedBoardingAddress":"selectedDroppingAddress"]:t}));const i=(a==="boarding"?r.boardingPoints:r.droppingPoints).find(n=>n.address===t);i&&g(n=>({...n,[a+"PointId"]:i.bpId}))},I=(a,s=0)=>{const t=a.target.value,d=r.availableSeats.find(i=>i.seatName===t);d&&g(i=>({...i,inventoryItems:i.inventoryItems.map((n,x)=>x===s?{...n,seatName:d.seatName,fare:d.fare,serviceTax:d.serviceTax,operatorServiceCharge:d.operatorServiceCharge,ladiesSeat:d.ladiesSeat}:n)}))},T=a=>{if(a.preventDefault(),!o.source||!o.destination){p(s=>({...s,errors:{source:"Please enter both source and destination"}}));return}p(s=>({...s,loading:!0,errors:{},success:""})),console.log("Form Data Submitted:",JSON.stringify(o,null,2)),k.post("/admin/bus-ticket/block/api",o,{onSuccess:()=>{p(s=>({...s,loading:!1,success:"Ticket blocked successfully!"})),g(h),p(s=>({...s,selectedBoardingAddress:"",selectedDroppingAddress:""}))},onError:s=>p(t=>({...t,loading:!1,errors:s}))})};return e.jsx(P,{children:e.jsx("div",{className:"max-w-full",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Reserve Bus Ticket"})}),e.jsxs("form",{onSubmit:T,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsx(c,{label:"Available Trip ID",icon:e.jsx(D,{size:20,className:"mr-2 text-green-500"}),error:r.errors.availableTripId,children:e.jsx("input",{type:"text",name:"availableTripId",value:o.availableTripId,onChange:m,className:l,required:!0})}),e.jsx(c,{label:"Boarding Point",icon:e.jsx(v,{size:20,className:"mr-2 text-yellow-500"}),error:r.errors.boardingPointId,children:e.jsxs("select",{value:r.selectedBoardingAddress,onChange:f("boarding"),className:l,disabled:!o.availableTripId||r.pointsLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select boarding point"},"default"),r.pointsLoading?e.jsx("option",{children:"Loading..."}):r.boardingPoints.map((a,s)=>e.jsxs("option",{value:a.address,children:[a.address," (ID: ",a.bpId,")"]},s))]})}),e.jsx(c,{label:"Dropping Point",icon:e.jsx(v,{size:20,className:"mr-2 text-red-500"}),error:r.errors.droppingPointId,children:e.jsxs("select",{value:r.selectedDroppingAddress,onChange:f("dropping"),className:l,disabled:!o.availableTripId||r.pointsLoading,required:!0,children:[e.jsx("option",{value:"",children:"Select dropping point"},"default"),r.pointsLoading?e.jsx("option",{children:"Loading..."}):r.droppingPoints.map((a,s)=>e.jsxs("option",{value:a.address,children:[a.address," (ID: ",a.bpId,")"]},s))]})}),e.jsx(c,{label:"Source",icon:e.jsx(v,{size:20,className:"mr-2 text-blue-500"}),error:r.errors.source,children:e.jsx("input",{type:"text",name:"source",value:o.source,onChange:m,className:l,placeholder:"Enter source",required:!0})}),e.jsx(c,{label:"Destination",icon:e.jsx(v,{size:20,className:"mr-2 text-purple-500"}),error:r.errors.destination,children:e.jsx("input",{type:"text",name:"destination",value:o.destination,onChange:m,className:l,placeholder:"Enter destination",required:!0})}),e.jsx(c,{label:"Booking Type",icon:e.jsx(C,{size:20,className:"mr-2 text-indigo-500"}),error:r.errors.bookingType,children:e.jsxs("select",{name:"bookingType",value:o.bookingType,onChange:m,className:l,children:[e.jsx("option",{value:"ONLINE",children:"Online"}),e.jsx("option",{value:"OFFLINE",children:"Offline"}),e.jsx("option",{value:"STANDARD",children:"Standard"})]})}),e.jsx(c,{label:"Service Charge",icon:e.jsx(u,{size:20,className:`mr-2 text-teal- /

500`}),error:r.errors.serviceCharge,children:e.jsx("input",{type:"number",name:"serviceCharge",value:o.serviceCharge,onChange:m,className:l,min:"0",disabled:r.pointsLoading})}),e.jsx(c,{label:"Payment Mode",icon:e.jsx(u,{size:20,className:"mr-2 text-orange-500"}),error:r.errors.paymentMode,children:e.jsxs("select",{name:"paymentMode",value:o.paymentMode,onChange:m,className:l,children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CARD",children:"Card"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"NETBANKING",children:"Netbanking"})]})})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),"Passenger Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Seat Name",icon:e.jsx(C,{size:20,className:"mr-2 text-gray-600"}),error:r.errors["inventoryItems.0.seatName"],children:e.jsxs("select",{name:"inventoryItems.0.seatName",value:o.inventoryItems[0].seatName,onChange:a=>I(a),className:l,disabled:!r.availableSeats.length,required:!0,children:[e.jsx("option",{value:"",children:"Select a seat"},"default"),r.availableSeats.length===0?e.jsx("option",{value:"",children:"No seats available"}):r.availableSeats.map((a,s)=>e.jsxs("option",{value:a.seatName,children:[a.seatName," (â‚¹",a.fare,")"]},s))]})}),e.jsx(c,{label:"Fare",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:r.errors["inventoryItems.0.fare"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.fare",value:o.inventoryItems[0].fare,onChange:m,className:l,min:"0",readOnly:!0})}),e.jsx(c,{label:"Service Tax",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:r.errors["inventoryItems.0.serviceTax"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.serviceTax",value:o.inventoryItems[0].serviceTax,onChange:m,className:l,min:"0",readOnly:!0})}),e.jsx(c,{label:"Operator Service Charge",icon:e.jsx(u,{size:20,className:"mr-2 text-gray-600"}),error:r.errors["inventoryItems.0.operatorServiceCharge"],children:e.jsx("input",{type:"number",name:"inventoryItems.0.operatorServiceCharge",value:o.inventoryItems[0].operatorServiceCharge,onChange:m,className:l,min:"0",readOnly:!0})}),e.jsx(c,{label:"Ladies Seat",icon:e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),error:r.errors["inventoryItems.0.ladiesSeat"],children:e.jsxs("select",{name:"inventoryItems.0.ladiesSeat",value:o.inventoryItems[0].ladiesSeat,onChange:m,className:l,disabled:!0,children:[e.jsx("option",{value:"false",children:"No"}),e.jsx("option",{value:"true",children:"Yes"})]})}),Object.entries(o.inventoryItems[0].passenger).map(([a,s])=>e.jsx(c,{label:a.charAt(0).toUpperCase()+a.slice(1),icon:e.jsx(b,{size:20,className:"mr-2 text-gray-600"}),error:r.errors[`inventoryItems.0.passenger.${a}`],children:a==="idType"?e.jsxs("select",{name:`inventoryItems.0.passenger.${a}`,value:s,onChange:m,className:l,required:!0,children:[e.jsx("option",{value:"PANCARD",children:"Pancard"}),e.jsx("option",{value:"AADHAAR",children:"Aadhaar Card"})]}):["title","gender","primary"].includes(a)?e.jsxs("select",{name:`inventoryItems.0.passenger.${a}`,value:s,onChange:m,className:l,children:[a==="title"&&["Mr","Ms","Mrs"].map(t=>e.jsx("option",{value:t,children:t},t)),a==="gender"&&["MALE","FEMALE"].map(t=>e.jsx("option",{value:t,children:t},t)),a==="primary"&&["0","1"].map(t=>e.jsx("option",{value:t,children:t==="0"?"No":"Yes"},t))]}):e.jsx("input",{type:a==="email"?"email":a==="age"||a==="mobile"?"number":"text",name:`inventoryItems.0.passenger.${a}`,value:s,onChange:m,className:l,...a==="age"?{min:1}:{},required:["name","mobile","age"].includes(a)})},a))]})]}),e.jsx("button",{type:"submit",disabled:r.loading||r.pointsLoading,className:"w-full bg-gray-800 text-white py-3 px-4 rounded-lg hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:r.loading?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 8.291l5.657-5.657C13.536 13.755 12.768 12 10.34 12H6c0-1.659.635-3.155 1.657-4.243C8.219 6.863 9.396 6.18 10.725 6.039 10.9 6.687 10.568 6.997 11 7c-0.031 0.001-0.326 0.016-0.743 0.656C11.091 7.891 12 8.973 12 10.7c0 2.172-1.7 4.257-4.8 7.2l1.086 1.623L12 18c2.333 0 4.167 1 5.5 3h-1c-1.167-1.5-2.667-2.167-4.5-2z"})]}),"Blocking Ticket..."]}):"Block Ticket"})]}),e.jsxs("div",{className:"px-6 pb-6",children:[Object.keys(r.errors).length>0&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-100 rounded-lg",children:e.jsxs("p",{className:"text-red-600 text-sm flex items-center",children:[e.jsx(L,{size:16,className:"mr-2"}),Object.values(r.errors)[0]]})}),r.success&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-100 rounded-lg",children:e.jsxs("p",{className:"text-green-600 text-sm flex items-center",children:[e.jsx(z,{size:16,className:"mr-2"}),r.success]})})]})]})})})};export{Y as default};
