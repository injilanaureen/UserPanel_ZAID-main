import{r,j as e}from"./app-DwfA8oYD.js";import{A as M}from"./AdminLayout-6K0BlJSL.js";import{R as W}from"./receipt-CpFeuNhW.js";import{S as L}from"./search-Bf0B5Lcu.js";import{L as Y,S as G}from"./ship-wheel-CLYgF8vv.js";import{L as B}from"./loader-circle-BbG6kUiz.js";import"./x-COPXyW5t.js";import"./createLucideIcon-rWaWmfOu.js";const le=()=>{const[j,d]=r.useState({source_id:"",destination_id:"",date_of_journey:""}),[m,u]=r.useState([]),[h,b]=r.useState(!1),[x,c]=r.useState(null),[l,P]=r.useState({busType:"",availability:"",fareRange:""}),[_,E]=r.useState([]),[q,O]=r.useState([]),[v,y]=r.useState(""),[S,w]=r.useState(""),[z,p]=r.useState(!1),[I,g]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const t=await fetch("/admin/busTicket/fetchSourceCities",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(!t.ok)throw new Error("Network response was not ok");const a=await t.json();if(a.status&&a.data.cities)E(a.data.cities),O(a.data.cities);else throw new Error("Failed to fetch cities data")}catch(t){c(t.message)}})()},[]);const T=_.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())).slice(0,10),A=q.filter(s=>s.name.toLowerCase().includes(S.toLowerCase())).slice(0,10),X=s=>{const{name:t,value:a}=s.target;d(i=>({...i,[t]:a})),c(null)},f=s=>{const{name:t,value:a}=s.target;P(i=>({...i,[t]:a}))},C=(s,t)=>{s==="source"?(d(a=>({...a,source_id:t.id})),y(t.name),p(!1)):(d(a=>({...a,destination_id:t.id})),w(t.name),g(!1))},H=async s=>{var t;s.preventDefault(),b(!0),c(null),u([]);try{const a=await fetch("/admin/busTicket/fetchAvailableTrips",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(j)}),i=await a.json();if(!a.ok)throw new Error(i.message||`HTTP error! status: ${a.status}`);const n=Array.isArray((t=i.data)==null?void 0:t.availableTrips)?i.data.availableTrips:[];u(n),n.length===0&&c("No trips found for the selected criteria.")}catch(a){c(a.message||"Failed to fetch trips. Please try again."),u([])}finally{b(!1)}},J=()=>m.filter(s=>{const t=!l.busType||s.busType===l.busType,a=parseInt(s.availableSeats)||0,i=!l.availability||l.availability==="1-5"&&a<=5||l.availability==="6-10"&&a>5&&a<=10||l.availability==="11-20"&&a>10&&a<=20||l.availability==="21+"&&a>20,n=parseFloat(s.fares)||0,o=!l.fareRange||l.fareRange==="low"&&n<=50||l.fareRange==="medium"&&n>50&&n<=200||l.fareRange==="high"&&n>200;return t&&i&&o}),V=()=>[...new Set(m.map(s=>s.busType).filter(Boolean))];return e.jsx(M,{children:e.jsxs("div",{className:"max-w-full",children:[e.jsx("div",{className:"bg-gradient-to-tr from-gray-400 to-black py-4 px-6",children:e.jsx("h2",{className:"text-3xl font-semibold text-white",children:"Search Available Bus Trips"})}),e.jsxs("form",{onSubmit:H,className:"space-y-4 mb-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(W,{size:20,className:"text-green-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Source City:"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:v,onChange:s=>{y(s.target.value),p(!0)},onFocus:()=>p(!0),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search source city...",required:!0}),z&&T.length>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border rounded-lg mt-1 max-h-60 overflow-y-auto",children:T.map(s=>e.jsxs("li",{onClick:()=>C("source",s),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[s.name,", ",s.state," (ID: ",s.id,")"]},s.id))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(Y,{size:20,className:"text-yellow-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Destination City:"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:S,onChange:s=>{w(s.target.value),g(!0)},onFocus:()=>g(!0),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",placeholder:"Search destination city...",required:!0}),I&&A.length>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border rounded-lg mt-1 max-h-60 overflow-y-auto",children:A.map(s=>e.jsxs("li",{onClick:()=>C("destination",s),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[s.name,", ",s.state," (ID: ",s.id,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(G,{size:20,className:"text-red-500 animate-bounce"}),e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"Date of Journey:"})]}),e.jsx("input",{type:"date",name:"date_of_journey",value:j.date_of_journey,onChange:X,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500",required:!0,min:new Date().toISOString().split("T")[0]})]})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-5 w-5 animate-spin mr-2"}),"Searching..."]}):"Search Trips"})]}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-600",children:x})}),h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(B,{className:"h-8 w-8 animate-spin"})}):m.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Available Trips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("select",{name:"busType",value:l.busType,onChange:f,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Bus Types"}),V().map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{name:"availability",value:l.availability,onChange:f,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Availabilities"}),e.jsx("option",{value:"1-5",children:"1-5 Seats"}),e.jsx("option",{value:"6-10",children:"6-10 Seats"}),e.jsx("option",{value:"11-20",children:"11-20 Seats"}),e.jsx("option",{value:"21+",children:"21+ Seats"})]}),e.jsxs("select",{name:"fareRange",value:l.fareRange,onChange:f,className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Fare Ranges"}),e.jsx("option",{value:"low",children:"Low Fare (≤₹50)"}),e.jsx("option",{value:"medium",children:"Medium Fare (₹51-₹200)"}),e.jsx("option",{value:"high",children:"High Fare (Above ₹200)"})]})]}),e.jsx("div",{className:"space-y-4",children:J().map(s=>{var t,a,i,n,o,D,F,R,k;return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Bus Type"}),e.jsx("p",{className:"font-medium",children:s.busType||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Available Seats"}),e.jsx("p",{className:"font-medium",children:s.availableSeats||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fare"}),e.jsxs("p",{className:"font-medium",children:["₹",s.fares||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("p",{className:"font-medium",children:s.duration||"N/A"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Boarding Points:"}),Array.isArray(s.boardingTimes)?s.boardingTimes.map((N,K)=>e.jsxs("p",{className:"font-medium",children:[N.bpName," - ",N.address," (Contact: ",N.contactNumber,")"]},K)):e.jsxs("p",{className:"font-medium",children:[((t=s.boardingTimes)==null?void 0:t.bpName)||"N/A"," - ",((a=s.boardingTimes)==null?void 0:a.address)||"N/A"," (Contact: ",((i=s.boardingTimes)==null?void 0:i.contactNumber)||"N/A",")"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Dropping Point:"}),e.jsxs("p",{className:"font-medium",children:[((n=s.droppingTimes)==null?void 0:n.bpName)||"N/A"," - ",((o=s.droppingTimes)==null?void 0:o.address)||"N/A"," (Contact: ",((D=s.droppingTimes)==null?void 0:D.contactNumber)||"N/A",")"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Cancellation Policy:"}),e.jsx("p",{className:"font-medium",children:s.cancellationPolicy||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fare Details:"}),e.jsxs("div",{className:"border-t pt-2",children:[e.jsxs("p",{className:"font-medium",children:["Base Fare: ₹",((F=s.fareDetails)==null?void 0:F.baseFare)||"N/A"]}),e.jsxs("p",{className:"font-medium",children:["GST: ₹",((R=s.fareDetails)==null?void 0:R.gst)||"N/A"]}),e.jsxs("p",{className:"font-medium",children:["Total Fare: ₹",((k=s.fareDetails)==null?void 0:k.totalFare)||"N/A"]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Operator:"}),e.jsx("p",{className:"font-medium",children:s.operator||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Travel Company:"}),e.jsx("p",{className:"font-medium",children:s.travels||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date of Journey:"}),e.jsx("p",{className:"font-medium",children:s.doj?new Date(s.doj).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Departure Time:"}),e.jsx("p",{className:"font-medium",children:s.departureTime||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Arrival Time:"}),e.jsx("p",{className:"font-medium",children:s.arrivalTime||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vehicle Type:"}),e.jsx("p",{className:"font-medium",children:s.vehicleType||"N/A"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vaccinated Bus:"}),e.jsx("p",{className:"font-medium",children:s.vaccinatedBus?"Yes":"No"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vaccinated Staff:"}),e.jsx("p",{className:"font-medium",children:s.vaccinatedStaff?"Yes":"No"})]})]},s.id)})})]}):!x&&e.jsx("div",{className:"text-gray-600 p-4",children:"No trips available. Please search with different criteria."})]})})};export{le as default};
