import{r as a,a as b,j as e}from"./app-C9Hasp1L.js";import{A}from"./AdminLayout-dj7iNOPP.js";import"./x-o7aJ_J0I.js";import"./createLucideIcon-BHfLX7CN.js";const R=()=>{const[d,f]=a.useState(""),[t,j]=a.useState(""),[o,N]=a.useState(""),[m,w]=a.useState([]),[x,p]=a.useState(null),[u,l]=a.useState(null),[c,h]=a.useState(!1),[v,g]=a.useState(!1);a.useEffect(()=>{F()},[]);const C=()=>{const s=document.querySelector('meta[name="csrf-token"]');return s?s.content:""},F=async()=>{var s;g(!0),l(null);try{const r=await b.post("/admin/get-bill-operators",{},{headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":C()}});if(r.data.success||r.data.status){const i=r.data.operators||((s=r.data.data)==null?void 0:s.data)||[];w(Array.isArray(i)?i:[])}else console.error("Failed to fetch operators:",r.data),l("Failed to load operators. Please try again later.")}catch(r){console.error("Fetch Operators Error:",r),l("An error occurred while fetching operators. Please try again later.")}finally{g(!1)}},k=async()=>{var s,r,i,y;if(!o){l("Please select an operator");return}if(!d.trim()){l("Please enter a consumer number");return}if(!t.trim()||isNaN(t)||parseFloat(t)<=0){l("Please enter a valid amount");return}try{h(!0),l(null),p(null);const n=await b.post("/admin/utility-bill-payment/process-bill-payment",{canumber:d.trim(),amount:parseFloat(t.trim()),operator:o});if(n.data.status===!1)throw new Error(n.data.message||"Payment failed");p(n.data)}catch(n){console.error("Payment Error:",n);const S=((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.error)||((y=(i=n.response)==null?void 0:i.data)==null?void 0:y.message)||n.message||"An unexpected error occurred during payment processing";l(S)}finally{h(!1)}},P=({data:s})=>{var r;return e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-green-50 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Payment Details"})}),e.jsx("div",{className:"p-4",children:e.jsx("table",{className:"w-full text-sm text-left text-gray-700",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50 w-1/3",children:"Status"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                  ${s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status?"Successful":"Failed"})})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Amount"}),e.jsxs("td",{className:"py-3 px-4",children:["₹",parseFloat(t).toFixed(2)]})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Operator"}),e.jsx("td",{className:"py-3 px-4",children:((r=m.find(i=>i.id===o))==null?void 0:r.name)||o})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Response Code"}),e.jsx("td",{className:"py-3 px-4",children:s.response_code})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Operator ID"}),e.jsx("td",{className:"py-3 px-4",children:s.operatorid})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Acknowledgement No"}),e.jsx("td",{className:"py-3 px-4",children:s.ackno})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50",children:"Reference ID"}),e.jsx("td",{className:"py-3 px-4",children:s.refid})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 font-medium text-gray-900 bg-gray-50 align-top",children:"Message"}),e.jsx("td",{className:"py-3 px-4",children:s.message})]})]})})})]})};return e.jsx(A,{children:e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6 text-center",children:"Pay Utility Bill"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"operator",className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator"}),v?e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Loading operators..."})]}):e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"operator",value:o,onChange:s=>N(s.target.value),className:`w-full px-4 py-3 rounded-lg border border-gray-300 
                    focus:ring-2 focus:ring-blue-500 focus:border-blue-500 
                    transition-all duration-200 placeholder-gray-400 appearance-none`,disabled:c,children:[e.jsx("option",{value:"",children:"Select an operator"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name||s.displayname},s.id))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"canumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Consumer Number"}),e.jsx("input",{id:"canumber",type:"text",value:d,onChange:s=>f(s.target.value),className:`w-full px-4 py-3 rounded-lg border border-gray-300 
                focus:ring-2 focus:ring-blue-500 focus:border-blue-500 
                transition-all duration-200 placeholder-gray-400`,placeholder:"Enter your consumer number",disabled:c})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (₹)"}),e.jsx("input",{id:"amount",type:"number",min:"1",step:"0.01",value:t,onChange:s=>j(s.target.value),className:`w-full px-4 py-3 rounded-lg border border-gray-300 
                focus:ring-2 focus:ring-blue-500 focus:border-blue-500 
                transition-all duration-200 placeholder-gray-400`,placeholder:"Enter payment amount",disabled:c})]}),e.jsx("button",{onClick:k,disabled:c||!d.trim()||!t.trim()||!o||isNaN(t)||parseFloat(t)<=0,className:`w-full py-3 px-4 rounded-lg font-semibold text-white
              ${c||!d.trim()||!t.trim()||!o||isNaN(t)||parseFloat(t)<=0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} 
              transition-colors duration-200 flex items-center justify-center`,children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Processing..."]}):"Pay Bill"}),x&&e.jsx(P,{data:x}),u&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700",children:u})]})]})]})})};export{R as default};
